import { Injectable, EventEmitter } from '@angular/core';
import { Recipe } from './recipe';
import { Ingredient } from '../shared';
import { Headers, Http, Response } from '@angular/http';
import 'rxjs/add/operator/map';
import 'rxjs/add/operator/catch';

@Injectable()
export class RecipeService {
  recipesChanged = new EventEmitter<Recipe[]>();

  private recipes: Recipe[] = [
    new Recipe(
      'Schnitzel', 
      'Very tasty', 
      'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxITEhUTEhIVFhUXFRUWFxUVFxUWFRgXFxYWGBcYGBYYHSggGBolGxcWITEhJSkrLi4uFx8zODMtNygtLisBCgoKDg0OGhAQGy8lICYtLS0vKy0tLTItLS0tLS0tLS0tLS0tLy0vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLf/AABEIALcBEwMBIgACEQEDEQH/xAAcAAAABwEBAAAAAAAAAAAAAAAAAQIDBAUGBwj/xAA9EAABAwIDBQUGBQMDBQEAAAABAAIRAyEEEjEFQVFhcQYigZGhEzKxwdHwBxRCUpIj4fEVM3JDVGKCopP/xAAaAQACAwEBAAAAAAAAAAAAAAAAAQIDBAUG/8QALhEAAgIBBAECAwcFAAAAAAAAAAECEQMEEiExQVFhEyJxFCMygaGx8BVS0eHx/9oADAMBAAIRAxEAPwDoqFkwa4QbUkwASeS5B0KY8XJdGm51gJU7C7N3v/j9VYsYBYCAtWPTN8y4KZ5kuiBR2d+4+AUynRaNAE6AjWqOOMekZ5Tb7Equ7QY1lKg9znZe6YjWeXNWJVTtrZza4Aee6DJG8+KhqMqxwb8kab6OJnD1X5jTY51+CTtzY9Rjab9CReWmx6rtFDBUqbctNgb4KNWwgd7wB5G64DyuNUiUdOvLOTYHYVfIw02kl597cBxWlpdkMzWte6YIceZWxOGAAAEAaI2MAVLzZG+y6GCEfcYPZ/2lE0y4AEQANyy+L7B4hohlRrhMzoY6aFbdr1Jw7jxsr/iuVWXQnKHRiG7PYwAOEuGpdqhWa22UAnotH2xwGaiajPeaJkcN4WI2fiJPvIdp0zVjlvjuLHY1X8vWc5ogO95vHmFrsPt+kYBME7isPiqzmulomfFP5SQ2Nee5asWpnjVLohlwxyO32dEZjqcTnHmnqGNpu0e0+IXPWyT73KERokHNoQZngVo/qDXaM/2Rep00FGufs23iN1XzAhTsL2wyFraw11eNBzIWiGsxyddFUtLkXXJs0FGw+La8ZmuBB0IT4ctRnFIIIIACNEgmAaS9gOoBRo0wK7EbHpu07p5aKqxWyqjLgZhy+i0yNUywQkWRyyRh31QDBseaScUz9wWr2lsejWEPbfiLEeKxm1ex9WnLqbi9vD9Q+qyz0849cmnHlhLh8DpxrP3BBZt+HIMGQeBRrPZp+GjYYLAuqG1hvO4LRYTCNpiGi+9x1KdpMDQGtEAJwBdDDgWNX5Odkyuf0AAlIBGrioCCCCTdANVXwFXvdmMz4KfXpzIVYbLganJKUm36/saIJUOZQklkoSkFyyvksE+xBJBMRqVHey9rp2pKIKb21VArG2Ap5lN3BOU6M6JNbFtpCS4Sh7YrdJ0g5bpDO2qwZh35j+h3wXK8C0aZld9re0Wcljb/AEVHhMrgjFJyuVcePobMeNwjyXDHEDXy1UygbCfPiq7DgyNPNTaTb62VtDZNaAL/AOUKjpBtJ4JqnS4myj4yu1msn5JAotvgXhnC5Np3KPjQHNN4iyiuxDXN/pm53b1nsZjajDGV2+SQYUopstUeeTU9kNo1aVX2TicrgSBqPDguhYbHcVxfY+0KntmFoJJcABu5+i6vh11NLJ7aZz9bBKdo0tGvKkBU+FfCsqVRblyYR5BG0o8qYCUEcIkABGiQQAaNJRoAafhKZMljSegRJ6UEUh2NtCUEAEaQgIIIJABECiJUbEYnKoZHStjSser1AIvdRnsaeXRQH1C4qRTBK87qYZ5TcsVfRmmKS7FVKTf3JhwaNXJraTsrZLgPnyCyeO2qZtm0WGU9SnTgv1/yaMeFTV2a2piKe8qFidrUmLEY3alQEDI4kxAt9hVtfF13a03AbrgpqOqk+XX5I0R00PLNhtDtZaG2WP2r2hc6YM/BVzcPVqZm3J1G4R80WH2UCHOqyMovE7uSvhpknum7ZYlCC4GsDVc/MXT1V5s/Z0CQTf0UTZ9ZmjbNkzfW1p5q2w5GQOm0ieR4LU0UQzwyOosc/JwIP0TVSq2mNSTrrAChbQ2iSYHSyrqFUuMEaqLRsjClyXtTa1hFuH9yoRqF5kmQUqjhjlg2A4pbcG5zmtbfNlA3XJCj7kHJLonbN2U+oYpsJPPQcydy02E7MNaJrOm1w3Tz3q2NJuFotYz3tJOpO8qJRqumZuknfZhnmk/wiaOFwrCMlISNDA+al1qzWwQ2QfBRazL5m2O8bvBADMI4JXXBU+eWSBimEbx4/RMYjBOImlWcORJI+oUd9k9TqFotrKPiP1/n7DSroVgdt16HdxFMuZ+9tyOvFWGH7X0HGMrxzIsolHFnR1woG1Nj5wX0HBrt7f0n6FasWuyxVN2J44SfzKv2Nvh8UyoJY4EcksrkuD2tVoviS14NwbTyIXRMFtTOxrrXE6yutg1CyL3KMuB4/oWqCYpYgFPSrykNBFKEpgGgiRoAJGiRoYAREo0hxSAarVICqKzy4qVj6m5R6DFnzfM9pZDjkew9JSiA0EnQCUKTViNr9oHPc9skMGgG8aXjUqjLKOKPJdhxSyukJ2/inVXB0uj9ugAn7uodGnyi/jrxTjnvdEgAQI/zxTlHC1GS4xNiAIJ5+K5Ltu2dK1FbUMYuk1padI1JuZVbiXWy74vG8ayFa4zB5rmb3IdBN93AJihs0CXkC3A2/uhcgpJIg4XCZu8LkCbT19EziMfTzZA0u1Bdpfmn8Vi/ZnuZZuIMxAnyWdo12PqGGva6SbwWa/u1IV8YOrfRg1OqpuMGrXqOPpDMTTy8cs/FDaW0i1jadgTJgWnn6KH+WIqS1wEmcsmw5Sk7Rw1XEZXU5yixkRv1G/QqdRa7KtHiyQzbmvA3hMZJAdrwV1gKDbuHGINsvTmoGA2WKRJM3GUaE3tv04KxpUgwd+QRuNrcVVOvB2eyypVWwd7vSOYV/wBlaBfXBMd1ubTwHx9FkWYrKCR4b1pOxGMa2u4Odd7QGgneLx4/JYtQ2sbaK8kGos1G3HuDgN0cFCouA08RuWgxNEPbB8FRVqOQwU8eZZY74/8ADnr0DDiiM6jxCSCjzwZTpkg6onvbt/VNByk08R35MZDqD06KM7W2inkj5TBMW1SKFYN5qKEoKEeOQasq+1nZ/wBvFej/ALggFpMBw+RCtdndymxnBoCk4J144hRW++4cD8QD810tBNXX847K8rbjT8FnhqxBVtRqyqOip9F668WZWWWZGHKMx6daVMQ7KCRKCYDyCCCQBJt6cKbqJAU+JdLk7QCYq+8pOHVMeZMsfSJjAud451MPdls3MbTJgTq7zXQ4MGNYtPHcuV7ZpvZUexwGYHLae8SAZWXXr5UbdBzJlhRxgPdaRaSpFCsCCRYydZmN8SqXB4gUwC43Iyj0sOOqs6GDLgXPcRIsB81ymvBsmqHA41MwvInSPG5TNVoyuEzBNmmd1pPVSw9jWRIGugvB3SVVEd6S+PqTu9LoRFIyu3qzs9mhpiJvu4cVCqksYxziSXEOGkRC1W2cC14Dt40Ot1m8bs6q5rW5hlaJAA3rTGca5Od9kn8bf4uyqr40ucPuLrdbI/2GnlE8Y38lif8ATn3v5gjeuhjDMZSDG2DGwP3GQLg8ZMqGVquDp4075KTHCDxO69h0PAH0KThaZee8ySLDedTpv8Slfkmtd3nOfJMXaIAE6n7srPDhoGaADy5eKrui2b9CNR2eXEzYW1tHS3IKBjq2R4yOcIuLiRwPhEqzdiIOognSDpZQMbQ74cBaIiIPu96UkrIxl6m+7G9pm4lmVzh7Vo7w0zR+oK8xtBrxfwK47nqU3B1J5zNIyuEA6d4QNQtfsjtw1xyYhopuH6plh01P6Tf+6wTwzwyc8S49DNlwc3EuqtF7DcSOI0/shMBTaONa4SDI5aJNem12+DyTx6yEuJcP9DO4tEVvNAsGiP8ALOGhBTvsTlkgz5rak5LjkjaI7mlGHkKHtDabKLczgbESALgExJ++KkbOxVPEMD6bxBtcwQd4jcULG3yg3q6LHA1NbbtVnG7SaMZUB0JDZ5gAK4x+NZQpuJMkA24ncAuYNxTsxc6cznEmeZlTxzcZJrwXYcSnd+TrVNyfa9U+xMV7Skx2+IPUK0aV3IytWjBKNOmTaNRTGFVtIqxo6K2LIMdRoIKYh5BEEaQATbwnElwSApcW2HJygU9tCnaVEwz1WlUifaLNhWL7c7JJeKzZyuADo/cNDysB5LY0ylV2McxwfGWDM8OKWbGskNpPBleKe5HJcNQbZ72XvBPujLwVr7cus3dHHw++ShYzE0g7KYy94NJ4TpKQ/F1BdlMxrFhJ6DQgSuFJWdt+rHsXVfOhI01vKiVqjnOyiAImJkW5kqaagdctIkD3iJ10jxUHHV20ySDdobreeXJRSYrvpDWL7ri4PdBOWL8INuKQ1zANDInz8U1i8YxvfJsY467vFRqmJY64cIgXOt+upUqYOn2W9LK6M8ZdYGqnd3KXkaAxNzI3md6oG4tkgh3dGv8AhWWx8YHlxAGonxGvW3qlXAoqhjGUyS0ibj9VoF7EbuqjioS4hgA3kG87rEC5m6tsbVDjlBjn4fQKrxWHLLzLTE20MSADrH9+SgvctYqniKeYh0gg8LA6dFJLg4jKDz4RGvWJ81UVIAtmeSe8Y0A+SssMA1pJn3RYXO/Td/hSZU0gqlNjWPBBJOXLrDYJ1jU6WPFVGILZMjXxBtrfQyprQ4y0HgZJHGfiAq2qyZLiTHOw5efxUoofA9hMTXoEGlUsROQyWdI6RpCucH22k5arC10xIuCfiFSUASO7EC1536/fNGaDHEg696NLbrQlLSwy/iX5mXPqMWNPc+S+2n2hqGn/AEn5eY1jlKr6e38R7PIa2bMLlxuOjgoO1IIDTp97lXPwLYzEhugABg9YCePDDEtsTIoLNFZZy2r0TLl2L9oDTe5wa5zXO5ls79/vFO1MRhKTfcDnbsxk+DRZUNGi2ZDnEzoJ809WwTQbwCdbzB4TuRODnSbdexLBDTxfd+78C8XtmpWcAXQ0aCb8pRNruc7LfruTDaLdzZdPG/IR5q4GzqhaXNaAR+mRcdVNRilSOlaRpexpILgXTYQ3Xr981r6ZWE7I06jahziO6d4M6RotxRK6Wmf3Zy9UvvCZRCs6Asq+gFZUtFsiZWOQgggpiHAUaQCloACIo0FEBqoyQqbEU8juSvSFHxNAOEFJqxp0Q8PWQ2pWDaNQkT3SI62+ahva6mb6JzEVgaT7/pPPdw3qEn8rJxXzIwb8L3QI7omwgNFxJnUnmf8AAcfZjmGmCD3vG0ERwUPbWJyvguzQdxIBEkSWi8W5ahMVMU4Ma5xMGYPEcLfNcJnd2i8RiwBNo1ta9xGnoqjaG1WyS4DNEQQCJmxjiE4/GAlw1ALryYJ+G435rJbYqCSRItHKxiLqzHC2J8LkGM2hUqd0dRcDfr5qThg4BoLpaYLgP3RaeQdKYoYZgyu1mJINjxVjicM0QQbEX5Hh98VdNpKkcXU62Tlti+AYR5Fw4tc3uggCb2tI4EpFLaJpVSWwJhpBEgNkE242HkomKkkNBiIM6GQ6QesH0San9R7nudEkmzXfRRULKYZsjp2+P9HQ8E1riXeHm2fKD6prFYcCbXNzwiLctFQ9lsZGVm6AI3j7hanG4bM0nifseiyTjtlR6GEtyVlWyiHDum2muv3dOVB7MNBNvgOKrRNMmxMCwLrXN4gWlD2peBM8xy67zCdA4jlbE5SYABPjM87RvUIYp7Scw11O4jRTsXS7siJA890XVNXrOiHcNFOKKskuOCXRxZc6zQG7gN0CBEJqtSuDmy81HwFcAAG1jbebKvw2IdVxEGSMx7vRbq4pHmnCTblI0mKqgNl1+B18lmH4tziYJ3p7F44lzhJIkxukA2UKkxzjlnW8JKKfgslh+HHl8kvAZi6ZMAjTUqxxFVrhIOm43nj0Q2fh2Mb3r8+FlDxFGSS0gkk2HWx8VFxTZCMZZE3Gy52c1zWe00dLrHRzfkdR4KyoYpsBwOul9P7qr2fhnBuTNAJmN4mLcFbYLChlhaSZmD5D6LNNKzuaeMoxX0JmzD/Va4WlwEXjXotzhysbsyA+RJHPiJ8lp8NXmwW7S8Rsp1XMi8wt1ZNKg4RkAKa1dBGJi5QQQUhCmuTgKYw1dtVudni3eCltKjGSatDaadMeQSQUpNiAiIRoJARsRQDhBVHjsI5oOpaQQY4FaQhNVKajKKkiUZOLOQdpZc9rSQACBlEmwAGY2vobdOZVU+jFPvOJAAtYRJ0A6grpvaDsu2vDmnKRu/SeXKdPFc97T4PE0GkVMO+BYPYfaU4mbnVu/Ub1yZ6bJHwdjHqsckkUmOxDiwlsgBoAERY5gMwG/Xz6KqxGBLwXg9wRcgzoDMQN/NSaNfMPdtF54gWgbv7qYzHvjK2lv1EJU4GLW61xqMCtqUDTAa85u6MhaBGgtrYBK2YwveGunKDM7geZVk32gBNi3QZssayPe+ChUHvJ9m0khzh3Jhsk9YUd18o5Le/klYjCvq14pjOGgaDujkToFY4fZnsh/VAEfq/Sec7uhS8FjK9KqKL3UmCR3XNAbBO5zND1VL2ixNb29U5qgYHlkFxLf+PDS8f5WnHJRjuXZZBpLgg4PabaOIc6CWF9t1pME+BNl0yjDgL2IBHDf5aFcqxeIsGh0iAfdEgkXEkSr3s52mbTaKdW0ANY6ba/qnSBaQs+bHuW5Lk6Ok1FfJJ/Q0WOpgy47pA5c+qg1aQaARHK94tu8U5iHioBBF94Mt65phR2YkDMJAMBocROs6Eyc3Lksyi6OtdkzC05JgTAzRwEXPNQsTs5lQkk2gQYgFR6tduUOAAMQJkusIvex3qTgsRLSXNFjvG+0/NStx5ISxWRGbCEktLpHGPuFDdgoGYN1ME8+i11Ku3eLx6z/hLoUWBwLgCJLjOhngpfGaMs9Pu7RgX0WixG+1lNweALRmyOvBDi0iZ4clsnUWtdnAAdJAcAJg7gd9kw6raTwtJ3AW118OKlHPRDLo/iqmzI4zD1ILQCGEjdrujzKQzZ+QFzjAi/G1tFZbSxJLSJG6A3rMKPVq5wc9rWiLkRrwT3tmjHhWKO1IlbNc3QOubRxEjT0Vo/DkAjUg25NI+u7kq7ZOQNm0zymbxzT35mXHKTJtlBmRwjTxUUrdE5MusNVMwRf6/ZWs2NhCIc7XcFS9m9nn3ni/w+q2OGorp6fG1FWcvPNOXBKpBSWhIpU1Ia1bEZgoQTkIJgY7DYp9N2Zhg+MEcCFpsBj2Vxbuv3t+Y4hYmpiaY/V9Ez/qTGmW5pFwRA9ZXHw55Y37HUyYFkXudFFtU4CsrsvtlTMMxEt4VIMf8AsIt1C07bgOaQ5puCDII6hdOGSM1aOfkxyg6kOIJIKUplYECEEaAG3MTVSiDYhSEIQBiu0nYejXbNINpPmZA7ruRA+I4LBbe7NYqkxrG03EuPecySAANLC0z6LuBakuphUZNPGbshKCk7OBbZ2cKeFp3eHtdDmkQ2+hIPA2H/ACUDC4CplLwJjLIGve4D71XoTEYJjxD2NcOBAPxVZX7M4Z3/AEw08Wkt9BZUy0noyPw0c+obFY91KrUJc9rYcHAd4EHK14M3bOu+EntTsJ2Jyua67Gvhu4udESd2i3LuyrR7r3DrBRt2G5vA+P1Viw8VRZtRwnFdm8S18OpOMx7txw1HRQ6+wMUH5RQqOkTZp0M6+S9DtwEasPoUsYZv7T5JrCLac37PdlfZ0xnzZiASDuPC3BS8V2ebqAQt6aDeCQ7DNVrxQapoujlnHpnMcRsQZpItMmAof5GHXnKL5RItz8F1Grs5hUOtsJjt3os+TRwfXBpx62ce+Tnzy8OyaxbWACTOpTdXFViGtDREjryW7f2Wn3cw6AqKexNY6P8A5BsbvHcsstFNdcmiOug+zMis6WyTlEXJMCJmY8I6KBtLFyMnuwNTuIGvQlbah2AxP6sZlEzDWBxniJhS2fhlhnXrVK1XkXBjT4MAPqlDQzvkb10F0clqVGB0e0EnQJdDZGMxB/o0nNbNnPltuN7ruOzex2Dof7WHptPHKC7+RurZmBaNAFshpEuzLPWSfRx7Y/4a1TBr1nu/8R3W+mq3WyuxtKloFrW0QnWsV6xRXgzSySfkgYXZrWiwUxlEBPAIwFYqICQ1KARo0wCQRwggDk/s3ch6pt2H4k+gHrKec8lMl2t1xDuBGm0bvOSp2zNt1cMf6Z7u9hnKfDceYVW8c5SS02gHTkPinGTTtClFNUzpGye02Hrw0n2VQ/pcbHo7Q+hV2QQuMOpE2IEdVZ7I7SYnDwBUzs/Y+XDwJMt8LclshqvEjHk0nmB1QFGsxs3tvhakCoTRd/5XZ/IaeMLS0nBwzNcHA6FpBHotUZxl0zHKEo/iQtBEgpEAIQjQQAnKhlSkEAJyoZUpEgBOVFlS0EAN5EPZpxBADfs0eRLQQAjIhlS0EAIhCEqERCYgoQhKhEgAAJSARoGEgjROcBqY6pgHCCz+3O2OFww79QF25ouT4C65v2g/EfEVpbQHs2/uN3+A0Hqqp5oRLYYZy6R15+0aQMF4nqgvOFSo9xLnOJJuSSSSgqPtXsX/AGX3OiuazefUpJe3cPID5pHszw+SL2DtZaPMrAbwi+P0/fgmajvuE/8Alr3cT0CHsRzKB2QyT0Ueq0qwyN3AffNJcQNI8EAVdXDu3D6JeBr16BzUqzqfJpserdCpdepOgJ6X3KM6mSPdPwTunwFWuTSYH8RK7IFem2qP3N7jvofRaTZ/bvA1LOeaR4VBA/kLeq5jUwbiDcAdVFfhAN8q+OonH3M8tNjl7HecNiWVBmpva8cWkEeidXn6jmpnMwuYeLXOB8wrfB9rdoUtKrnDhUaHDzN/VXx1SfaM8tG10ztUo1y7CfiXiBarh6bubXFp8rq3w/4m4U/7lOozoA4ehVqz435Knp8i8G6QWZw3bvAP0rhv/IFvxCs6G38K/wB3EUz/AOzfqrFOL6ZU4SXaLNBMMxdM6PafFLFVv7h5qREcQSPaDiPND2g4hAC0Ej2g4jzSTXb+4eaAHUFHdjaY1e3zUettqg3Wq0eKVodMnois/ie2eCZrXZ/IfVVOL/E3At0cXdA4/AKDyQXkmsU30jbBBcuxv4ts/wCnRcesD5z6Kgx34n4t9mtazzd9FB54IsWmyM7c+q0akDqVVbT7UYWgJqVmjxC4Lje0uLq+/XfHBpyj0uqwgkyZJ4m58yq3qvRF0dH/AHM6xtj8WaQkYem554xlb5m/osPtbtrjcRM1Cxv7WW/+tfKFRsaeBT1OkeColmlLtmiOGEekMhriZMk7ydfElPMpHgn20SpDKB4jzKqssI4pHgESnih0QSEbY1OQTHt77kaCiSSAQ43+iDqRO8DzKCCYrCOGbNyT6I/yYIJDfElBBFCbYo4cxqB5/RM/kjpPyQQSYWI/IgSCPVNDCj9o+/FBBKxphVMO6dw++AUOvhov/ZBBG4aIdSkN8+ajvw7eHzQQTsbRGqUUw6ly+CCCdiEtzDQkdCR8E63FVxpVqjpUd9UEEWKhX+qYoaYir/8Ao76ojtjGf9zV/mUEFLcw2oS7a+L/AO4q/wAymH7SxJ1xFT+b/qggi2CSGn1qh1qvPVzj80wac6knmUEEDCFIIBgQQQMWKfJLFLl8EEErAWKRTjaJQQSbAdZQKeZQ5+iCCViJNPDjipLMOEEExD4wvL1QQQRYrP/Z',
      [
        new Ingredient('French Fries', 2),
        new Ingredient('Pork Meat', 1)
      ]
    ),
    new Recipe(
      'Summer Salad', 
      'Okayish', 
      'http://ohmyveggies.com/wp-content/uploads/2013/06/the_perfect_summer_salad.jpg', 
      [

      ])
  ];
  constructor(private http: Http) { }

  getRecipes() {
    return this.recipes;
  }

  getRecipe(id: number) {
    return this.recipes[id];
  }

  deleteRecipe(recipe: Recipe) {
    this.recipes.splice(this.recipes.indexOf(recipe), 1);
  }

  addRecipe(recipe: Recipe) {
    this.recipes.push(recipe);
  }

  editRecipe(oldRecipe: Recipe, newRecipe: Recipe) {
    this.recipes[this.recipes.indexOf(oldRecipe)] = newRecipe;
  }

  storeData() {
    const body = JSON.stringify(this.recipes);
    const headers = new Headers({
      'Content-Type' : 'application/json'
    });

    return this.http.put('https://recipebook-54ac6.firebaseio.com/recipes.json', body, { headers: headers });
  }

  fetcgData() {
    return this.http.get('https://recipebook-54ac6.firebaseio.com/recipes.json')
    .map((response: Response) => response.json())
    .subscribe(
      (data: Recipe[]) => {
        this.recipes = data;
        this.recipesChanged.emit(this.recipes);
      }
    )
  }
}
